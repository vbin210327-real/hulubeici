# 葫芦背词 - App Store 上架前检查清单

在提交 App Store 审核前，请逐项检查以下内容，确保万无一失。

---

## 📋 代码与配置检查

### Xcode 项目配置

- [ ] **Bundle ID 正确**
  - 确认为 `com.hulubeici`
  - 位置：Xcode → 项目 → General → Identity

- [ ] **版本号设置**
  - Version：1.0（或您的版本号）
  - Build：1（或递增的编号）
  - 位置：Xcode → 项目 → General → Identity

- [ ] **Deployment Target**
  - ✅ 已设置为 iOS 17.0
  - 位置：project.pbxproj 文件

- [ ] **Team 选择**
  - 已选择正确的 Apple Developer Team
  - 位置：Xcode → 项目 → Signing & Capabilities

- [ ] **Signing 配置**
  - Debug：Development Certificate
  - Release：Distribution Certificate
  - Provisioning Profile 已正确配置

### Entitlements 和 Capabilities

- [ ] **iCloud 配置**
  - ✅ 已添加 iCloud Capability
  - ✅ CloudKit 已勾选
  - ✅ Container `iCloud.com.hulubeici` 已勾选

- [ ] **APS Environment**
  - ✅ 已修改为 `production`（不是 development）
  - 位置：`葫芦背词.entitlements`

- [ ] **In-App Purchase**
  - 已添加 In-App Purchase Capability

- [ ] **Push Notifications**
  - 已添加 Push Notifications Capability（如使用）

### 代码质量

- [ ] **订阅 Product ID 正确**
  - Plus Monthly：`com.hulubeici.plus.monthly`
  - Pro Yearly：`com.hulubeici.pro.yearly`
  - 位置：`Entitlements.swift`

- [ ] **iCloud Container ID 正确**
  - `iCloud.com.hulubeici`
  - 位置：`APIConfig.swift`

- [ ] **无 Debug 代码**
  - 没有 `print("test")` 等调试输出
  - 没有测试用的硬编码数据

- [ ] **无 TODO/FIXME**
  - 搜索项目中的 `TODO` 和 `FIXME`
  - 确保关键功能没有未完成项

- [ ] **StoreKit 测试文件不包含在 Release 中**
  - ✅ `StoreKit.storekit` 已从 Bundle Resources 移除
  - 或仅在 Debug 配置中包含

---

## 🛡️ Apple Developer Portal

### App ID 配置

- [ ] **App ID 已创建**
  - Bundle ID：`com.hulubeici`
  - 位置：[developer.apple.com/account](https://developer.apple.com/account) → Identifiers

- [ ] **Capabilities 已启用**
  - ✅ iCloud（包含 CloudKit support）
  - ✅ Push Notifications
  - ✅ In-App Purchase

### iCloud Container

- [ ] **Container 已创建**
  - Container ID：`iCloud.com.hulubeici`
  - 位置：Developer Portal → Identifiers → iCloud Containers

- [ ] **Container 已关联到 App ID**
  - 在 App ID 详情页中，iCloud 配置已包含此 Container

### Provisioning Profiles

- [ ] **Development Profile 已创建**
  - 名称：Hulu Beici Development
  - 已下载并安装到 Xcode

- [ ] **Distribution Profile 已创建**
  - 名称：Hulu Beici App Store
  - 已下载并安装到 Xcode

### 证书

- [ ] **Development Certificate 有效**
  - 未过期
  - 已安装到钥匙串

- [ ] **Distribution Certificate 有效**
  - 未过期
  - 已安装到钥匙串

---

## 💳 App Store Connect

### App 基本信息

- [ ] **App 记录已创建**
  - App 名称：葫芦背词
  - Bundle ID：com.hulubeici
  - SKU：hulubeici-ios-001（或您的 SKU）

- [ ] **隐私政策 URL 已填写**
  - URL 必须是 HTTPS
  - 页面可公开访问
  - 内容完整（使用提供的 `PrivacyPolicy.md`）

- [ ] **服务条款 URL 已填写**
  - URL 必须是 HTTPS
  - 页面可公开访问
  - 内容完整（使用提供的 `TermsOfService.md`）

### 订阅产品配置

- [ ] **订阅组已创建**
  - 组名：premium
  - 本地化名称已添加（中文、英文）

- [ ] **Plus Monthly 订阅已创建**
  - Product ID：`com.hulubeici.plus.monthly`
  - 价格：¥9/月
  - 时长：1 个月
  - 本地化描述已填写
  - 状态：准备提交或已批准

- [ ] **Pro Yearly 订阅已创建**
  - Product ID：`com.hulubeici.pro.yearly`
  - 价格：¥70/年
  - 时长：1 年
  - 本地化描述已填写
  - 状态：准备提交或已批准

- [ ] **免费试用已配置（可选）**
  - 试用时长：7 天（推荐）
  - 引入优惠已添加

### App 版本信息

- [ ] **版本号正确**
  - 版本：1.0（与 Xcode 一致）

- [ ] **新增功能已填写**
  - 中文描述清晰
  - 英文描述完整（如支持）

- [ ] **App 描述已填写**
  - 突出核心功能
  - 提到内置词库
  - 说明订阅权益
  - 字数 2000-4000 字为佳

- [ ] **关键词已设置**
  - 示例：`英语词汇,背单词,四六级,考研英语,托福,单词本,学习,教育`
  - 使用逗号分隔，不超过 100 字符

- [ ] **支持 URL 已填写**
  - 可以是电子邮件或网页
  - 示例：`mailto:your-email@example.com`

- [ ] **营销 URL（可选）**

### 截图和预览

- [ ] **iPhone 截图已上传**
  - 6.5 英寸（iPhone 15 Pro Max）：至少 3 张
  - 建议上传 5-8 张，展示核心功能

- [ ] **iPad 截图已上传（可选）**
  - 12.9 英寸（iPad Pro）
  - 如果 App 支持 iPad

- [ ] **App 预览视频（可选）**
  - 15-30 秒短视频
  - 展示 App 使用流程

### 截图内容建议

1. **主页/单词书列表**：展示内置词库
2. **学习界面**：展示单词学习页面
3. **进度统计**：展示学习进度和统计
4. **会员页面**：展示订阅权益
5. **个人中心**：展示用户资料和设置

### 分级和内容

- [ ] **年龄分级已设置**
  - 建议：4+（教育类 App）
  - 没有不当内容

- [ ] **内容版权已确认**
  - 词库来源合法
  - 没有侵权内容

### 审核信息

- [ ] **联系信息已填写**
  - 姓名、电话、电子邮件

- [ ] **审核备注已填写**
  - 说明测试流程
  - 提供测试账号（如需要）
  - 说明订阅产品

示例备注：
```
葫芦背词是一款英语词汇学习 App。

测试说明：
1. 免费用户可以使用所有内置单词本（无限制）
2. 免费用户可以创建最多 2 个自定义单词本
3. 订阅会员可以创建无限单词本并使用 AI 助手
4. 订阅产品：Plus 月度（¥9）和 Pro 年度（¥70）

测试账号（如有）：
用户名：test@example.com
密码：TestPassword123

特别说明：
- 使用 iCloud 同步用户数据
- 订阅状态通过 StoreKit 2 API 验证
- 所有数据存储在用户的 iCloud 私有数据库
```

---

## 🧪 功能测试

### 基础功能

- [ ] **App 启动正常**
  - 无崩溃
  - 加载速度合理（< 3 秒）

- [ ] **内置单词本加载**
  - 所有单词本可以正常打开
  - 单词内容显示正确

- [ ] **自定义单词本**
  - 创建功能正常
  - 导入功能正常
  - 编辑和删除正常

- [ ] **学习功能**
  - 翻页正常
  - 标记已完成正常
  - 进度保存正常

- [ ] **统计功能**
  - 学习进度显示正确
  - 每日统计正常

### iCloud 同步

- [ ] **首次同步**
  - App 启动后自动拉取云端数据
  - 查看 Xcode 控制台，确认 `[iCloud] Pull completed`

- [ ] **数据上传**
  - 添加单词本后，数据自动上传
  - 查看 Xcode 控制台，确认 `[iCloud] Uploaded data successfully`

- [ ] **多设备同步**
  - 在设备 A 添加数据
  - 在设备 B 查看，确认数据已同步

- [ ] **冲突处理**
  - 在两台设备上同时修改数据
  - 确认不会丢失数据

- [ ] **网络异常**
  - 关闭网络，修改数据
  - 恢复网络，确认数据上传

- [ ] **iCloud 存储检查**
  - 设置 → [您的姓名] → iCloud → 管理储存空间 → 葫芦背词
  - 确认有数据占用

### 订阅功能

- [ ] **订阅页面显示**
  - Plus 和 Pro 产品都显示
  - 价格正确（¥9 和 ¥70）
  - 描述清晰

- [ ] **沙盒测试购买**
  - 使用沙盒测试账号
  - 可以完成购买流程
  - 购买后会员状态正确

- [ ] **权益验证**
  - 订阅后可以创建无限单词本
  - 订阅后 AI 助手限额提升

- [ ] **恢复购买**
  - 点击"恢复购买"
  - 之前的订阅状态可以恢复

- [ ] **订阅过期**
  - 使用 Xcode Transaction Manager 测试过期
  - 确认显示"已过期"状态

- [ ] **订阅状态持久化**
  - 订阅后关闭 App
  - 重新打开，订阅状态保持

### UI/UX

- [ ] **适配不同屏幕**
  - iPhone SE（小屏）
  - iPhone 15 Pro（标准）
  - iPhone 15 Pro Max（大屏）
  - iPad（如支持）

- [ ] **深色模式**
  - 切换到深色模式
  - 所有页面显示正常

- [ ] **横屏模式（如支持）**
  - 旋转设备
  - 布局正常

- [ ] **无障碍功能**
  - VoiceOver 可以正常朗读
  - 字体大小调整正常

### 性能

- [ ] **内存使用**
  - 打开 Xcode Instruments
  - 运行 Allocations 和 Leaks 检查
  - 确保无内存泄漏

- [ ] **电池消耗**
  - 后台运行不耗电
  - 前台使用电池消耗合理

- [ ] **网络使用**
  - iCloud 同步不过度消耗流量
  - 适当使用 Wi-Fi 优先策略

---

## 📱 真机测试

### 测试设备

至少在以下设备上测试：

- [ ] **iPhone（任意一款）**
  - iOS 17.0 或以上

- [ ] **iPad（可选）**
  - iPadOS 17.0 或以上

### 测试场景

- [ ] **全新安装**
  - 删除 App
  - 重新安装
  - 首次启动体验流畅

- [ ] **更新安装**
  - 从旧版本更新（如有）
  - 数据迁移正常

- [ ] **卸载重装**
  - 卸载 App
  - 重新安装
  - iCloud 数据自动恢复

- [ ] **不同网络环境**
  - Wi-Fi
  - 4G/5G
  - 离线模式

- [ ] **低电量模式**
  - 启用低电量模式
  - App 功能正常

---

## 🌐 法律与合规

### 隐私政策

- [ ] **隐私政策已托管**
  - URL 可访问（HTTPS）
  - 内容基于提供的 `PrivacyPolicy.md`
  - 包含：数据收集、使用、存储、第三方服务

- [ ] **隐私政策包含必要信息**
  - iCloud 使用说明
  - 订阅信息说明
  - 数据删除说明
  - 联系方式

### 服务条款

- [ ] **服务条款已托管**
  - URL 可访问（HTTPS）
  - 内容基于提供的 `TermsOfService.md`
  - 包含：使用规则、订阅条款、退款政策

- [ ] **订阅条款明确**
  - 自动续订说明
  - 取消订阅说明
  - 退款政策

### App 内说明

- [ ] **订阅页面包含链接**
  - 隐私政策链接
  - 服务条款链接
  - 自动续订说明

- [ ] **EULA（可选）**
  - 如有自定义 EULA，需在 App 内显示

---

## 📦 Archive 和上传

### 构建设置

- [ ] **Scheme 设置为 Release**
  - Product → Scheme → Edit Scheme
  - Run 配置为 Release

- [ ] **Generic iOS Device**
  - 选择"Any iOS Device (arm64)"
  - 不要选择模拟器

### Archive

- [ ] **清理项目**
  - Product → Clean Build Folder (⇧⌘K)

- [ ] **Archive 成功**
  - Product → Archive
  - 无编译错误或警告

- [ ] **Organizer 检查**
  - Window → Organizer
  - 选择最新的 Archive
  - 确认版本号和 Build 号正确

### 验证

- [ ] **Validate App**
  - 在 Organizer 中点击"Validate App"
  - 选择 Distribution Certificate
  - 选择 App Store Distribution Profile
  - 等待验证完成（可能需要几分钟）
  - 确保无错误，警告可酌情处理

### 上传

- [ ] **Distribute App**
  - 在 Organizer 中点击"Distribute App"
  - 选择"App Store Connect"
  - 选择"Upload"
  - 等待上传完成（可能需要 10-30 分钟）

- [ ] **上传成功确认**
  - 在 App Store Connect 中查看
  - 进入 App → Activity → 所有构建版本
  - 确认新版本出现（可能需要处理 10-60 分钟）

---

## ✅ 提交审核

### 最后检查

- [ ] **构建版本已选择**
  - 在 App Store Connect → 版本信息中
  - 选择刚上传的构建版本

- [ ] **出口合规性**
  - 如果使用加密：填写出口合规信息
  - 如果不使用：选择"否"

- [ ] **广告标识符（IDFA）**
  - 如果不使用广告：选择"否"

- [ ] **内容版权**
  - 确认所有内容版权合法
  - 没有使用未授权的第三方资源

### 提交

- [ ] **保存所有更改**
  - 所有必填项已填写
  - 没有红色错误提示

- [ ] **点击"提交以供审核"**
  - 确认所有信息无误
  - 点击"提交"

- [ ] **审核状态监控**
  - 状态从"等待审核"开始
  - 通常变为"正在审核"
  - 最终变为"准备提交"或"被拒绝"

---

## 🔔 审核后续

### 审核通过

- [ ] **发布 App**
  - 选择"自动发布"或"手动发布"
  - 如果手动，在准备好后点击"发布此版本"

- [ ] **监控用户反馈**
  - 查看 App Store 评分和评论
  - 及时回复用户问题

- [ ] **监控崩溃率**
  - 在 App Store Connect → 分析 → 崩溃
  - 如果崩溃率高，及时修复

### 审核被拒

- [ ] **阅读拒绝原因**
  - 仔细阅读 App Store Connect 的拒绝消息
  - 查看 Resolution Center 中的详细说明

- [ ] **修复问题**
  - 根据拒绝原因修改代码或配置
  - 常见原因：
    - 功能不完整
    - 订阅说明不清楚
    - 隐私政策缺失或不符
    - 内容违规

- [ ] **回复审核团队**
  - 在 Resolution Center 回复
  - 说明您的修改
  - 或解释误解

- [ ] **重新提交**
  - 如果需要代码修改，重新 Archive 和上传
  - 如果只是文字修改，直接在 App Store Connect 修改
  - 重新提交审核

---

## 📊 上线后监控

### 第一周

- [ ] **每天检查崩溃报告**
- [ ] **监控订阅转化率**
- [ ] **回复用户评论**
- [ ] **检查 iCloud 同步问题报告**

### 第一月

- [ ] **分析用户留存率**
- [ ] **收集功能改进建议**
- [ ] **监控服务器（如有）负载**
- [ ] **准备第一次更新**

---

## 📝 备注

### 审核时间线参考

- **初次提交**：1-3 天
- **更新提交**：24-48 小时
- **拒绝后重新提交**：同上

### 联系 Apple 审核团队

如果有疑问或需要加急：

1. 登录 App Store Connect
2. 点击"?"图标
3. 选择"联系我们"
4. 选择"App 审核"
5. 填写表单并提交

---

## ✨ 恭喜！

如果您完成了以上所有检查项，您的 App 已经准备好提交审核了！

**预祝审核顺利通过！🎉**

---

**最后更新：2025年**
